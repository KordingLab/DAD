%%%%% Script to run DAD on Chewie and Mihi's data

% initialize parameters
C = setinputparams();

% Load neural (Y) and movement (X) datasets
load Chewie_12192013;
Dtr1= out_struct;

load Chewie_10032013;
Dtr2= out_struct;
load Mihi_small;
Dte=out_struct;

% compute firing rates from spike data
tttr1  = ff_trial_table_co(Dtr1);
tttr2  = ff_trial_table_co(Dtr2);
ttte  =  ff_trial_table_co(Dte);

[~   , X1 ,  T1,  N1]  =  getFR(Dtr1,  C.delT,  tttr1 );
[~   , X2 ,  T2,  N2]  =  getFR(Dtr2,  C.delT,  tttr2 );
[Y3   , X3 ,  T3,  N3]  =  getFR(Dte,   C.delT,  ttte );

clear Dtr1
clear Dtr2
clear Dte

% normalize data
XN1=normal(X1);
XN2=normal(X2);
Xtr=[ XN1; XN2 ];
Ttr=[ T1; T2 ];
Ntr=[N1; N2];

dsz=size(Y3,1);
dsz1=round(dsz/3);

Yte=Y3(dsz1+1:end, :);
Xte=X3(dsz1+1:end, :);
Tte=T3(dsz1+1:end, :);
Nte=N3(dsz1+1:end, :);

dimte=size(Yte,2);

% remove time points where monkey is resting
tindte= (  Tte ~=7 & Tte ~= 0  & Tte~=2);
tindtr= (  Ttr ~=7 & Ttr ~= 0  & Ttr~=2 );

Xtr = Xtr(tindtr,:);
Ttr = Ttr(tindtr,:);
Ntr = Ntr(tindtr,:);
Tte = Tte(tindte);
Yte = Yte(tindte,:);
Xte = Xte(tindte,:);
Nte = Nte(tindte,:);
XteN = normal(Xte); % normalize test movement data
XAll=normal(Xtr);

Results = DAD(Yte,XAll,C,Xte);




